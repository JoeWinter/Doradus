<?xml version="1.0"?>

<project name="Doradus" default="DoradusBuild" basedir=".">

    <property name="doradus.version"        value="2.1.1"/>
    <property name="ant.build.javac.target" value="1.7"/>

    <target name="DoradusBuild"
        depends="ServerBuild,ClientBuild,ClientDoc"/>

    <property name="doradus.dir" location="${basedir}"/>
    <property name="build.dir"   location="${doradus.dir}"/>

    <!-- ============================================================================== -->
    <!-- Set Proxy (if needed)                                                          -->
    <!-- ==============================================================================	-->
    <target name="SetProxy">
		<!--
		<setproxy
		    proxyuser="..."
			proxypassword="..."
			proxyhost="proxy.sitelocal"
			proxyport="8080"
		/>
		-->
		<setproxy
			proxyhost="proxy.sitelocal"
			proxyport="8080"
		/>
	</target>

    <!-- ============================================================================== -->
    <!-- Doradus Common                                                                 -->
    <!-- ==============================================================================	-->
    <property name="common.dir"      location="${doradus.dir}/doradus-common" />
    <property name="common.bin.dir"  location="${common.dir}/bin" />
    <property name="common.lib.dir"  location="${common.dir}/lib" />
    <property name="common.src.dir"  location="${common.dir}/src" />
    <property name="common.jar.file" value="doradus-common.jar" />
	
    <target name="CommonBuild" depends="SetProxy">
	
        <delete dir="${common.bin.dir}" failonerror="false"/>
        <mkdir  dir="${common.bin.dir}"/>
		
        <delete dir="${common.lib.dir}" failonerror="false"/>
        <mkdir  dir="${common.lib.dir}"/>
		
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/it/sauronsoftware/cron4j/cron4j/2.2.5/cron4j-2.2.5.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/log4j/log4j/1.2.16/log4j-1.2.16.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/slf4j/slf4j-api/1.6.1/slf4j-api-1.6.1.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/slf4j/slf4j-log4j12/1.6.1/slf4j-log4j12-1.6.1.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/yaml/snakeyaml/1.6/snakeyaml-1.6.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/com/megginson/sax/xml-writer/0.2/xml-writer-0.2.jar"/> 
		</get>

        <javac srcdir="${common.src.dir}" destdir="${common.bin.dir}"
               verbose="yes" includeantruntime="false"
               debug="true" debuglevel="lines,vars,source">
            <classpath>
                <fileset dir="${common.lib.dir}" includes="**/*.jar" />
            </classpath>
        </javac>
		
        <jar jarfile="${common.lib.dir}/${common.jar.file}">
            <fileset dir="${common.bin.dir}" includes="**/*.class"/>
            <manifest>
                <attribute name="Implementation-Title"   value="Doradus" />
                <attribute name="Implementation-Version" value="${doradus.version}" />
                <attribute name="Implementation-Vendor"  value="DELL Inc." />
                <attribute name="Javac-Target"           value="${ant.build.javac.target}" />
            </manifest>
        </jar>
		
        <delete dir="${common.bin.dir}" failonerror="false"/>
	</target>
	
	<target name="CommonCleanup">
        <delete dir="${common.bin.dir}" failonerror="false"/>
        <delete dir="${common.lib.dir}" failonerror="false"/>
	</target>
	

    <!-- ============================================================================== -->
    <!-- Doradus Server                                                                 -->
    <!-- ==============================================================================	-->
    <property name="server.dir"        location="${doradus.dir}/doradus-server" />
    <property name="server.bin.dir"    location="${server.dir}/bin" />
    <property name="server.config.dir" location="${server.dir}/config" />
    <property name="server.lib.dir"    location="${server.dir}/lib" />
    <property name="server.src.dir"    location="${server.dir}/src" />
    <property name="server.jar.file"   value="doradus.jar" />
	
    <target name="ServerBuild" depends="SetProxy,CommonBuild" >
	
        <delete dir="${server.bin.dir}" failonerror="false"/>
        <mkdir  dir="${server.bin.dir}"/>
		
        <delete dir="${server.lib.dir}" failonerror="false"/>
        <mkdir  dir="${server.lib.dir}"/>
		
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/apache/cassandra/cassandra-all/1.2.6/cassandra-all-1.2.6.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/apache/cassandra/cassandra-clientutil/1.2.6/cassandra-clientutil-1.2.6.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/apache/cassandra/cassandra-thrift/1.2.6/cassandra-thrift-1.2.6.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/it/sauronsoftware/cron4j/cron4j/2.2.5/cron4j-2.2.5.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/com/google/guava/guava/13.0.1/guava-13.0.1.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/eclipse/jetty/aggregate/jetty-all/9.0.6.v20130930/jetty-all-9.0.6.v20130930.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/apache/thrift/libthrift/0.7.0/libthrift-0.7.0.jar"/> 
		</get>
		<get dest="${server.lib.dir}">
			<url url="http://repo1.maven.org/maven2/javax/servlet/javax.servlet-api/3.0.1/javax.servlet-api-3.0.1.jar"/> 
		</get>
		<get dest="${common.lib.dir}">
			<url url="http://repo1.maven.org/maven2/org/yaml/snakeyaml/1.6/snakeyaml-1.6.jar"/> 
		</get>

        <javac  srcdir="${server.src.dir}" destdir="${server.bin.dir}"
                verbose="yes" includeantruntime="false"
                debug="true" debuglevel="lines,vars,source">
            <classpath>
                <fileset dir="${server.lib.dir}" includes="**/*.jar" />
                <fileset dir="${common.lib.dir}" includes="**/*.jar" />
            </classpath>
        </javac>

        <jar jarfile="${server.lib.dir}/${server.jar.file}">
            <fileset dir="${server.bin.dir}" includes="**/*.class"/>
            <manifest>
                <attribute name="Implementation-Title"   value="Doradus" />
                <attribute name="Implementation-Version" value="${doradus.version}" />
                <attribute name="Implementation-Vendor"  value="DELL Inc." />
                <attribute name="Javac-Target"           value="${ant.build.javac.target}" />
                <attribute name="Main-class"             value="com.dell.doradus.core.DoradusServer" />
                <attribute name="Class-path"             value="../config/ cassandra-all-1.2.6.jar cassandra-clientutil-1.2.6.jar cassandra-thrift-1.2.6.jar cron4j-2.2.5.jar doradus-common.jar guava-13.0.1.jar javax.servlet-api-3.0.1.jar jetty-all-9.0.6.v20130930.jar libthrift-0.7.0.jar log4j-1.2.16.jar slf4j-api-1.6.1.jar slf4j-log4j12-1.6.1.jar snakeyaml-1.6.jar xml-writer-0.2.jar" />
            </manifest>
        </jar>
		
				<copy todir="${server.lib.dir}">
    			<fileset dir="${common.lib.dir}"/>
  			</copy>

        <delete dir="${server.bin.dir}" failonerror="false"/>
	</target>
	
	<target name="ServerCleanup">
        <delete dir="${server.bin.dir}" failonerror="false"/>
        <delete dir="${server.lib.dir}" failonerror="false"/>
	</target>

    <!-- ============================================================================== -->
    <!-- Doradus Client                                                                 -->
    <!-- ==============================================================================	-->
    <property name="client.dir"        location="${doradus.dir}/doradus-client" />
    <property name="client.bin.dir"    location="${client.dir}/bin" />
    <property name="client.config.dir" location="${client.dir}/config" />
    <property name="client.lib.dir"    location="${client.dir}/lib" />
    <property name="client.src.dir"    location="${client.dir}/src" />
    <property name="client.jar.file"   value="doradus-client.jar" />
	
    <target name="ClientBuild" depends="SetProxy,CommonBuild" >
	
        <delete dir="${client.bin.dir}" failonerror="false"/>
        <mkdir  dir="${client.bin.dir}"/>
		
        <delete dir="${client.lib.dir}" failonerror="false"/>
        <mkdir  dir="${client.lib.dir}"/>
		
        <javac  srcdir="${client.src.dir}" destdir="${client.bin.dir}"
                verbose="yes" includeantruntime="false"
                debug="true" debuglevel="lines,vars,source">
            <classpath>
                <fileset dir="${client.lib.dir}" includes="**/*.jar" />
                <fileset dir="${common.lib.dir}" includes="**/*.jar" />
            </classpath>
        </javac>

        <jar jarfile="${client.lib.dir}/${client.jar.file}">
            <fileset dir="${client.bin.dir}" includes="**/*.class"/>
            <manifest>
                <attribute name="Implementation-Title"   value="Doradus Client" />
                <attribute name="Implementation-Version" value="${doradus.version}" />
                <attribute name="Implementation-Vendor"  value="DELL Inc." />
                <attribute name="Javac-Target"           value="${ant.build.javac.target}" />
            </manifest>
        </jar>

        <delete dir="${client.bin.dir}" failonerror="false"/>
	</target>
	
	<target name="ClientCleanup">
        <delete dir="${client.bin.dir}" failonerror="false"/>
        <delete dir="${client.lib.dir}" failonerror="false"/>
	</target>

    <!-- ============================================================================== -->
    <!-- Doradus Client Doc                                                             -->
    <!-- ==============================================================================	-->
    <property name="client.doc.dir" location="${client.dir}/docs" />
    <property name="client.tmp.doc.dir" location="${client.dir}/doc.tmp" />
	
    <target name="ClientDoc" depends="CommonBuild,ClientBuild">
        <delete dir="${client.doc.dir}"     failonerror="false"/>
        <delete dir="${client.tmp.doc.dir}" failonerror="false"/>
	
        <javadoc access="public" author="true"
		    classpath="${common.lib.dir}/doradus-common.jar:
			           ${common.lib.dir}/xml-writer-0.2.jar:
					   ${common.lib.dir}/snakeyaml-1.6.jar:
					   ${common.lib.dir}/log4j-1.2.16.jar:
					   ${common.lib.dir}/argo-small-2.21.jar:
					   ${common.lib.dir}/slf4j-log4j12-1.6.1.jar:
					   ${common.lib.dir}/cron4j-2.2.5.jar:
					   ${common.lib.dir}/slf4j-api-1.6.1.jar"
		    destdir="${client.tmp.doc.dir}"
		    doctitle="Doradus Client"
		    nodeprecated="false"
		    nodeprecatedlist="false"
		    noindex="false"
		    nonavbar="false"
		    notree="false"
		    packagenames="com.dell.doradus.management,com.dell.doradus.common,com.dell.doradus.client.utils,com.dell.doradus.client"
		    source="1.7"
		    sourcepath="${common.src.dir}:src"
		    splitindex="true" use="true" version="true"/>

		<zip destfile="${client.doc.dir}/docs.zip">
			<zipfileset dir="${client.tmp.doc.dir}"/>
		</zip>

        <delete dir="${client.tmp.doc.dir}" failonerror="false"/>
    </target>
	
    <target name="Cleanup" depends="CommonCleanup,ClientCleanup,ServerCleanup" />
	
</project>






















